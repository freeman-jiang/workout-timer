<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a1a2e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Workout Timer</title>
  <link rel="manifest" href="manifest.json">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #1a1a2e;
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: background 0.3s ease;
    }

    body.work {
      background: #064e3b;
    }

    body.rest {
      background: #1e3a5f;
    }

    body.warmup {
      background: #4a1a6b;
    }

    .phase-label {
      font-size: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 0.2em;
      opacity: 0.8;
      margin-bottom: 10px;
    }

    .timer {
      font-size: 8rem;
      font-weight: 200;
      font-variant-numeric: tabular-nums;
      line-height: 1;
      margin-bottom: 20px;
    }

    .round-info {
      font-size: 1.2rem;
      opacity: 0.7;
      margin-bottom: 40px;
    }

    .controls {
      display: flex;
      gap: 15px;
      margin-bottom: 40px;
    }

    button {
      background: rgba(255, 255, 255, 0.15);
      border: none;
      color: white;
      padding: 15px 35px;
      font-size: 1.1rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    button:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: scale(1.05);
    }

    button:active {
      transform: scale(0.98);
    }

    button.primary {
      background: rgba(255, 255, 255, 0.25);
      padding: 18px 50px;
      font-size: 1.3rem;
    }

    .settings {
      display: flex;
      flex-direction: column;
      gap: 15px;
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }

    .setting-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
    }

    .setting-row label {
      font-size: 1rem;
      opacity: 0.9;
    }

    .setting-row input {
      width: 80px;
      padding: 10px 15px;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      text-align: center;
    }

    .setting-row input:focus {
      outline: 2px solid rgba(255, 255, 255, 0.5);
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 480px) {
      .timer {
        font-size: 5rem;
      }
      
      .controls {
        flex-direction: column;
        width: 100%;
      }
      
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="phase-label" id="phaseLabel">Ready</div>
  <div class="timer" id="timer">00:00</div>
  <div class="round-info" id="roundInfo">-</div>

  <div class="controls" id="controls">
    <button class="primary" id="startBtn">Start</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div class="settings" id="settings">
    <div class="setting-row">
      <label>Work (sec)</label>
      <input type="number" id="workTime" value="45" min="5" max="300">
    </div>
    <div class="setting-row">
      <label>Rest (sec)</label>
      <input type="number" id="restTime" value="15" min="5" max="300">
    </div>
    <div class="setting-row">
      <label>Rounds</label>
      <input type="number" id="rounds" value="8" min="1" max="50">
    </div>
  </div>

  <script>
    // State
    let isRunning = false;
    let isPaused = false;
    let currentPhase = 'warmup'; // 'warmup', 'work', or 'rest'
    let currentRound = 1;
    let timeRemaining = 0;
    let intervalId = null;
    const WARMUP_TIME = 5;

    // Audio context for beeps
    let audioCtx = null;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playBeep(frequency = 800, duration = 150, count = 1) {
      if (!audioCtx) return;
      
      for (let i = 0; i < count; i++) {
        setTimeout(() => {
          const oscillator = audioCtx.createOscillator();
          const gainNode = audioCtx.createGain();
          
          oscillator.connect(gainNode);
          gainNode.connect(audioCtx.destination);
          
          oscillator.frequency.value = frequency;
          oscillator.type = 'sine';
          
          gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration / 1000);
          
          oscillator.start(audioCtx.currentTime);
          oscillator.stop(audioCtx.currentTime + duration / 1000);
        }, i * 200);
      }
    }

    // DOM elements
    const phaseLabel = document.getElementById('phaseLabel');
    const timerDisplay = document.getElementById('timer');
    const roundInfo = document.getElementById('roundInfo');
    const startBtn = document.getElementById('startBtn');
    const resetBtn = document.getElementById('resetBtn');
    const settings = document.getElementById('settings');
    const workTimeInput = document.getElementById('workTime');
    const restTimeInput = document.getElementById('restTime');
    const roundsInput = document.getElementById('rounds');

    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function updateDisplay() {
      timerDisplay.textContent = formatTime(timeRemaining);
      if (currentPhase === 'warmup') {
        phaseLabel.textContent = 'Get Ready';
        roundInfo.textContent = 'Starting soon...';
      } else {
        phaseLabel.textContent = currentPhase === 'work' ? 'Work' : 'Rest';
        roundInfo.textContent = `Round ${currentRound} of ${parseInt(roundsInput.value)}`;
      }
      
      document.body.classList.remove('work', 'rest', 'warmup');
      if (isRunning || isPaused) {
        document.body.classList.add(currentPhase);
      }
    }

    function tick() {
      if (timeRemaining > 0) {
        timeRemaining--;
        
        // Countdown beeps for last 3 seconds
        if (timeRemaining <= 3 && timeRemaining > 0) {
          playBeep(600, 100);
        }
        
        updateDisplay();
      } else {
        // Phase complete
        if (currentPhase === 'warmup') {
          // Warmup done, start first work period
          playBeep(1000, 200, 2);
          currentPhase = 'work';
          timeRemaining = parseInt(workTimeInput.value);
        } else if (currentPhase === 'work') {
          // Work done, start rest
          playBeep(1000, 200, 2);
          currentPhase = 'rest';
          timeRemaining = parseInt(restTimeInput.value);
        } else {
          // Rest done, next round or finish
          if (currentRound >= parseInt(roundsInput.value)) {
            // Workout complete!
            playBeep(1200, 300, 3);
            stopTimer();
            phaseLabel.textContent = 'Done!';
            roundInfo.textContent = 'Workout complete';
            return;
          } else {
            playBeep(800, 200, 2);
            currentRound++;
            currentPhase = 'work';
            timeRemaining = parseInt(workTimeInput.value);
          }
        }
        updateDisplay();
      }
    }

    function startTimer() {
      initAudio();
      
      if (!isRunning && !isPaused) {
        // Fresh start - begin with warmup
        currentPhase = 'warmup';
        currentRound = 1;
        timeRemaining = WARMUP_TIME;
      }
      
      isRunning = true;
      isPaused = false;
      startBtn.textContent = 'Pause';
      settings.classList.add('hidden');
      
      updateDisplay();
      intervalId = setInterval(tick, 1000);
    }

    function pauseTimer() {
      isRunning = false;
      isPaused = true;
      startBtn.textContent = 'Resume';
      clearInterval(intervalId);
    }

    function stopTimer() {
      isRunning = false;
      isPaused = false;
      clearInterval(intervalId);
      startBtn.textContent = 'Start';
      settings.classList.remove('hidden');
    }

    function resetTimer() {
      stopTimer();
      currentPhase = 'warmup';
      currentRound = 1;
      timeRemaining = WARMUP_TIME;
      phaseLabel.textContent = 'Ready';
      roundInfo.textContent = '-';
      document.body.classList.remove('work', 'rest', 'warmup');
      timerDisplay.textContent = formatTime(parseInt(workTimeInput.value));
    }

    // Event listeners
    startBtn.addEventListener('click', () => {
      if (isRunning) {
        pauseTimer();
      } else {
        startTimer();
      }
    });

    resetBtn.addEventListener('click', resetTimer);

    // Update display when settings change
    workTimeInput.addEventListener('change', () => {
      if (!isRunning && !isPaused) {
        timerDisplay.textContent = formatTime(parseInt(workTimeInput.value));
      }
    });

    // Initialize display
    timerDisplay.textContent = formatTime(parseInt(workTimeInput.value));

    // Register service worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('SW registered'))
        .catch(err => console.log('SW registration failed:', err));
    }
  </script>
</body>
</html>
